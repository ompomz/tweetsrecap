<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>tweets recap</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif; line-height: 1.5; background-color: #f7f7f7; color: #666; font-size: 0.9rem; padding: 0.5rem; }
.container { max-width: 600px; margin: 0; padding: 0.5rem; border-radius: 4px; }
.container h1 { font-size: 1.3rem; }
.container h2 { font-size: 1.1rem; }
.container p { padding: 0.25rem 0rem; }
.container a { color: #66b3ff; text-decoration: none; }
.container a:hover { color: #4da6ff; text-decoration: underline; }
@media (max-width: 767px) { .container { max-width: 100%; } }
.container button { border: none; font-size: 0.8rem; padding: 0.5rem 0.8rem; border-radius: 999px; font-weight: bold; cursor: pointer; background-color: #ffb366; color: #fff; transition: background-color 0.3s ease, color 0.3s ease; }
.container button:hover { background-color: #ffa347; }
.header-section { display: flex; justify-content: flex-start; align-items: center; gap: 0.5rem; padding: 0.5rem 0; border-bottom: 1px dashed #ddd; }
#main-event { padding: 0.5rem 0; }
#status { margin: 0.5rem 0rem; font-weight: bold; color: #ff99cc; }
.reactions-list { display: flex; flex-wrap: wrap; gap: 0.5rem; padding: 0.25rem 0rem 0.75rem 0rem; }
.reaction-group { display: flex; align-items: center; background-color: #eee; border-radius: 999px; padding: 0.2rem 0.5rem; font-size: 0.8rem; }
.reaction-emoji { line-height: 1rem; height: 1rem; }
.reaction-custom-emoji { height: 1rem; width: auto; }
.reaction-avatars { display: flex; flex-direction: row-reverse; }
.reaction-avatar { width: 1rem; height: 1rem; border-radius: 50%; object-fit: cover; display: block; vertical-align: middle; margin-bottom: 0; }
.related-posts { margin: 0.5rem 0rem; }
.related-post-card { background-color: #fff; border: 1px solid #ddd; border-radius: 4px; padding: 0.5rem; margin: 0.5rem 0rem; }
.related-post-card .profile { display: flex; align-items: center; gap: 0.5rem; margin: 0.5rem 0rem; }
.related-post-card .profile-name, .related-post-card .profile-npub { font-size: 0.8rem; }
.related-post-card .profile-image { width: 1.5rem; height: 1.5rem; }
.related-post-card .post-content { font-size: 0.8rem; margin: 0.25rem 0rem; }
.profile { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
.profile-image { width: 2rem; height: 2rem; border-radius: 50%; object-fit: cover; }
.profile-name { font-weight: bold; font-size: 1rem; color: #444; }
.profile-nip05, .profile-npub { font-size: 0.8rem; color: #999; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; }
.profile-picture { width: 6rem; height: 6rem; border-radius: 50%; object-fit: cover; margin: 0.5rem 0rem; border: 2px solid #ffb366; }
.profile-card { display: flex; flex-direction: column; gap: 1rem; padding: 1rem; background-color: #fff; border-radius: 8px; border: 1px solid #ddd; }
.profile-header { display: flex; align-items: flex-start; gap: 1rem; }
.profile-info-container { flex: 1; display: flex; flex-direction: column; gap: 0.25rem; }
.npub-container { display: flex; align-items: center; gap: 0.5rem; font-size: 0.75rem; word-break: break-all; }
.copy-icon { cursor: pointer; transition: opacity 0.2s ease; }
.copy-icon:hover { opacity: 0.4; }
.about-text { font-size: 0.9rem; line-height: 1.5; color: #333; word-break: break-all; }
.about-text a { color: #66b3ff; text-decoration: underline; }
.about-text a:hover { color: #4da6ff; }
.about-text .custom-emoji { height: 1.2rem; width: auto; vertical-align: middle; }
.post-info { display: flex; align-items: center; gap: 0.5rem; font-size: 0.8rem; color: #999; }
.post-content { margin: 0.5rem 0rem; line-height: 1.5; overflow-wrap: break-word; word-break: break-word; }
.post-content img { max-width: 15rem; max-height: 15rem; height: auto; display: block; margin: 0.5rem 0rem; }
.post-content img.custom-emoji { vertical-align: middle; display: inline-block; height: 1.2rem !important; }
.post-content ul, .post-content ol { list-style-position: inside; }
.nostr-form { display: flex; flex-direction: row; align-items: center; gap: 0.5rem; padding-bottom: 0.25rem; }
.form-input { flex: 1; min-width: 0; width: 100%; max-width: 400px; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem; }
.form-button { flex-shrink: 0; padding:0.5rem 1.2rem !important; }
.footer-section { padding: 0.5rem 0; border-top: 1px dashed #ddd; }
.hidden { display: none; }
</style>
</head>
<body>
<div id="header-placeholder"></div>
<div class="container">
 <div class="header-section">
 <button onclick="goBack()">もどる</button>
 <button onclick="copyUrl()">シェア</button>
 </div>
 <div id="main-event"></div>
 <p id="status" class="hidden"></p>
 <div id="reactions-section" style="display: none;">
 <div id="reactions-list" class="reactions-list"></div>
 </div>
 <div id="related-events-section" style="display: none;">
 <div id="related-events-list" class="related-posts"></div>
 </div>
 <div class="footer-section">
 <button onclick="goBack()">もどる</button>
 </div>
</div>
<script src="https://unpkg.com/nostr-tools@1.17.0/lib/nostr.bundle.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
 function goBack() {
 if (window.history.length > 1) {
 window.history.back();
 } else {
 window.location.href = 'https://ompomz.github.io/tweetsrecap/tweet';
 }
 }

 function copyUrl() {
 navigator.clipboard.writeText(window.location.href)
 .then(() => {
 alert('URLがコピーされました！');
 })
 .catch(err => {
 console.error('URLのコピーに失敗しました:', err);
 alert('URLのコピーに失敗しました。');
 });
 }

 const mainEventContainer = document.getElementById('main-event');
 const statusElement = document.getElementById('status');
 const reactionsSection = document.getElementById('reactions-section');
 const reactionsList = document.getElementById('reactions-list');
 const relatedEventsSection = document.getElementById('related-events-section');
 const relatedEventsList = document.getElementById('related-events-list');

 const FALLBACK_RELAYS = [
 'wss://relay.nostr.band',
 'wss://nos.lol',
 ];
 const DEFAULT_PROFILE_IMAGE = 'https://ompomz.github.io/favicon.ico';
 const pool = new window.NostrTools.SimplePool();
 const userProfiles = {};

 FALLBACK_RELAYS.forEach(url => {
 pool.ensureRelay(url).then(relay => {
 relay.on('connect', () => console.log(`✅ リレーに接続しました: ${url}`));
 relay.on('disconnect', () => console.warn(`⚠️ リレーから切断されました: ${url}`));
 relay.on('error', () => console.error(`❌ リレー接続エラー: ${url}`));
 }).catch(err => {
 console.error(`接続プールの設定中にエラーが発生しました: ${url}`, err);
 });
 });

 function showStatus(message) {
 statusElement.textContent = message;
 if (message) {
 statusElement.classList.remove('hidden');
 } else {
 statusElement.classList.add('hidden');
 }
 }

 function escapeHtml(str) {
 if (!str) return '';
 return str.replace(/[&<>"']/g, function(match) {
 const escape = {
 '&': '&amp;',
 '<': '&lt;',
 '>': '&gt;',
 '"': '&quot;',
 "'": '&#39;'
 };
 return escape[match];
 });
 }

 function createNostrLink(nip19) {
 try {
 const decoded = window.NostrTools.nip19.decode(nip19);
 const {
 type,
 data
 } = decoded;
 if (type === 'note' || type === 'nevent') {
 return `?id=${nip19}`;
 } else if (type === 'npub' || type === 'nprofile') {
 const pubkey = data.id || data;
 const npub = window.NostrTools.nip19.npubEncode(pubkey);
 return `?id=${npub}`;
 } else if (type === 'naddr') {
 return `?id=${nip19}`;
 }
 return '#';
 } catch (e) {
 console.error('Failed to decode nostr link:', e);
 return '#';
 }
 }

 function formatPostContent(content, tags) {
 let formattedContent = escapeHtml(content);
 formattedContent = formattedContent.replace(/(https?:\/\/[^\s]+)/g, (url) => {
 if (/\.(png|jpe?g|gif|webp|svg|heic|avif)$/i.test(url)) {
 return `<a href="${url}" target="_blank" rel="noopener noreferrer"><img src="${url}" alt="post image" class="post-image"></a>`;
 }
 return `<a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>`;
 });
 formattedContent = formattedContent.replace(/nostr:(n(?:pub|event|note|profile|relay|addr)1\S+)/g, (match, nip19) => {
 const link = createNostrLink(nip19);
 return `<a href="${link}" class="nostr-link">${match}</a>`;
 });
 const customEmojis = tags.filter(t => t[0] === 'emoji');
 customEmojis.forEach(([_, shortcode, url]) => {
 const regex = new RegExp(`:${shortcode}:`, 'g');
 formattedContent = formattedContent.replace(regex, `<img src="${url}" alt="${shortcode}" class="custom-emoji">`);
 });
 return formattedContent.replace(/\n/g, '<br>');
 }

 async function fetchProfiles(pubkeys) {
 if (pubkeys.length === 0) return;
 const pubkeysToFetch = pubkeys.filter(pubkey => !userProfiles[pubkey]);
 if (pubkeysToFetch.length > 0) {
 console.log(`ℹ️ ${pubkeysToFetch.length}件の新しいプロフィールイベント (kind:0) をフェッチします。`);
 }
 if (pubkeysToFetch.length === 0) return;
 const until = Math.floor(Date.now() / 1000);
 const profiles = await pool.list(FALLBACK_RELAYS, [{
 kinds: [0],
 authors: pubkeysToFetch,
 until: until
 }]);
 console.log(`✅ ${profiles.length}件のプロフィールイベントを取得しました。`);
 profiles.forEach(p => {
 try {
 userProfiles[p.pubkey] = JSON.parse(p.content);
 } catch (e) {
 console.error('❌ プロフィールJSONのパースに失敗しました:', p.pubkey, e);
 }
 });
}

 function createProfileHtml(pubkey, isLink = true) {
 const profile = userProfiles[pubkey] || {
 name: 'Unknown',
 picture: DEFAULT_PROFILE_IMAGE
 };
 const npub = window.NostrTools.nip19.npubEncode(pubkey);
 const profileContentHtml = `
 <div class="profile">
 <img src="${profile.picture}" class="profile-image" alt="User profile image">
 <div>
 <span class="profile-name">${escapeHtml(profile.name)}</span>
 <span class="profile-nip05">${profile.nip05 ? escapeHtml(profile.nip05) : npub.substring(0, 8) + '...' + npub.slice(-4)}</span>
 </div>
 </div>
 `;
 if (isLink) {
 const profileUrl = `?id=${npub}`;
 return `<a href="${profileUrl}" class="profile-link">${profileContentHtml}</a>`;
 } else {
 return profileContentHtml;
 }
 }
 
 function renderMainEvent(event) {
 const date = new Date(event.created_at * 1000).toLocaleString();
 const client = event.tags.find(t => t[0] === 'client')?.[1] || '';
 let contentHtml;
 if (event.kind === 30023) {
 contentHtml = window.marked.parse(event.content);
 contentHtml = contentHtml.replace(/nostr:(n(?:pub|event|note|profile|relay|addr)1\S+)/g, (match, nip19) => {
 const link = createNostrLink(nip19);
 return `<a href="${link}" class="nostr-link">${match}</a>`;
 });
 } else {
 contentHtml = formatPostContent(event.content, event.tags);
 }
 const html = `
 ${createProfileHtml(event.pubkey)}
 <div class="post-content">${contentHtml}</div>
 <div class="post-info">
 <span>${date}</span>
 ${client ? `<span>via ${escapeHtml(client)}</span>` : ''}
 </div>
 `;
 mainEventContainer.innerHTML = html;
 }

 function renderReactions(reactions, customEmojiMap) {
 console.log("カスタム絵文字マップ:", customEmojiMap);
 const reactionGroups = new Map();
 reactions.forEach(reaction => {
 const emoji = reaction.content.trim();
 if (!reactionGroups.has(emoji)) {
 reactionGroups.set(emoji, {
 count: 0,
 pubkeys: new Set()
 });
 }
 const group = reactionGroups.get(emoji);
 group.count++;
 group.pubkeys.add(reaction.pubkey);
 });
 reactionsList.innerHTML = '';
 for (const [emoji, group] of reactionGroups.entries()) {
 const avatarsHtml = Array.from(group.pubkeys).map(pubkey => {
 const profile = userProfiles[pubkey] || {
 picture: DEFAULT_PROFILE_IMAGE
 };
 const npub = window.NostrTools.nip19.npubEncode(pubkey);
 const profileUrl = `?id=${npub}`;
 return `<a href="${profileUrl}"><img src="${profile.picture}" class="reaction-avatar" alt="reaction user avatar"></a>`;
 }).join('');
 let displayedEmojiHtml;
 const emojiUrl = customEmojiMap.get(emoji);
 console.log("リアクションの絵文字:", emoji, "URL:", emojiUrl);

 if (emojiUrl) {
 displayedEmojiHtml = `<img src="${emojiUrl}" alt="${emoji}" class="reaction-custom-emoji">`;
 } else {
 const displayedEmoji = emoji === '+' ? '⭐' : emoji;
 displayedEmojiHtml = `<span class="reaction-emoji">${displayedEmoji}</span>`;
 }
 const groupHtml = `
 <div class="reaction-group">
 ${displayedEmojiHtml}
 <div class="reaction-avatars">${avatarsHtml}</div>
 </div>
 `;
 reactionsList.innerHTML += groupHtml;
 }
 reactionsSection.style.display = 'block';
 }

 function renderRelatedEvents(posts, reposts, quotes) {
 const allRelatedEvents = [...posts, ...reposts, ...quotes];
 allRelatedEvents.sort((a, b) => b.created_at - a.created_at);
 relatedEventsList.innerHTML = '';
 allRelatedEvents.forEach(event => {
 const date = new Date(event.created_at * 1000).toLocaleString();
 let postContentHtml = '';
 let postTypeLabel = '';
 switch (event.kind) {
 case 1:
 postTypeLabel = 'リプライ';
 postContentHtml = `<div class="post-content">${formatPostContent(event.content, event.tags)}</div>`;
 break;
 case 6:
 postTypeLabel = 'リポスト';
 const repostUser = userProfiles[event.pubkey] || {
 name: 'Unknown'
 };
 postContentHtml = `<div class="post-content">${escapeHtml(repostUser.name)}さんがリポストしました</div>`;
 break;
 case 16:
 postTypeLabel = '引用';
 postContentHtml = `<div class="post-content">${formatPostContent(event.content, event.tags)}</div>`;
 break;
 }
 const html = `
 <div class="related-post-card">
 ${createProfileHtml(event.pubkey)}
 <div class="post-info">
 <span>${date}</span>
 <span>${postTypeLabel}</span>
 </div>
 ${postContentHtml}
 </div>
 `;
 relatedEventsList.innerHTML += html;
 });
 relatedEventsSection.style.display = 'block';
 }

 async function renderEventDetail(nostrId) {
 showStatus('イベントデータを取得中...');
 try {
 const decoded = window.NostrTools.nip19.decode(nostrId);
 const relays = (decoded.data.relays && decoded.data.relays.length > 0) ? decoded.data.relays : FALLBACK_RELAYS;
 const until = Math.floor(Date.now() / 1000);
 let eventId;
 let filters = {};
 switch (decoded.type) {
 case 'note':
 case 'nevent':
 eventId = decoded.data.id || decoded.data;
 filters = {
 ids: [eventId]
 };
 break;
 case 'naddr':
 eventId = decoded.data.id;
 filters = {
 authors: [decoded.data.pubkey],
 kinds: [decoded.data.kind],
 '#d': [decoded.data.identifier]
 };
 break;
 default:
 showStatus('エラー: 無効なID形式です。');
 return;
 }
 console.log(`ℹ️ ID ${nostrId} の取得を開始します。`);
 console.log(' - フィルター:', filters);
 console.log(' - 使用リレー:', relays);
 const mainEventPromise = pool.get(relays, {
 ...filters,
 until: until,
 limit: 1
 });
 const relatedEventsPromise = pool.list(relays, [{
 '#e': [eventId],
 kinds: [1, 6, 7, 16],
 until: until
 }]);
 const [mainEvent, relatedEvents] = await Promise.all([mainEventPromise, relatedEventsPromise]);
 if (!mainEvent) {
 console.warn('⚠️ メインイベントが見つかりませんでした。');
 showStatus('イベントが見つかりませんでした');
 return;
 }
 const customEmojis = mainEvent.tags.filter(t => t[0] === 'emoji');
 const customEmojiMap = new Map();
 customEmojis.forEach(([_, shortcode, url]) => {
 customEmojiMap.set(`:${shortcode}:`, url);
 });
 const reactionEmojis = relatedEvents
 .filter(e => e.kind === 7)
 .flatMap(e => e.tags.filter(t => t[0] === 'emoji'));
 reactionEmojis.forEach(([_, shortcode, url]) => {
 if (!customEmojiMap.has(`:${shortcode}:`)) {
 customEmojiMap.set(`:${shortcode}:`, url);
 }
 });
 console.log('✅ メインイベント取得成功:', {
 id: mainEvent.id.substring(0, 8) + '...',
 kind: mainEvent.kind,
 author: mainEvent.pubkey.substring(0, 8) + '...'
 });
 if (relatedEvents.length > 0) {
 console.log(`✅ 関連イベントを ${relatedEvents.length} 件取得しました。`);
 } else {
 console.warn('⚠️ 関連イベントは見つかりませんでした。');
 }
 const pubkeysToFetch = new Set();
 pubkeysToFetch.add(mainEvent.pubkey);
 relatedEvents.forEach(e => pubkeysToFetch.add(e.pubkey));
 console.log(`ℹ️ プロフィールをフェッチするpubkey: ${Array.from(pubkeysToFetch).length}件`);
 await fetchProfiles(Array.from(pubkeysToFetch));
 console.log(`✅ ${Object.keys(userProfiles).length}件のプロフィールを取得しました。`);
 renderMainEvent(mainEvent);
 const reactions = relatedEvents.filter(e => e.kind === 7);
 const posts = relatedEvents.filter(e => e.kind === 1);
 const reposts = relatedEvents.filter(e => e.kind === 6);
 const quotes = relatedEvents.filter(e => e.kind === 16);
 console.log(` - リアクション (kind:7): ${reactions.length}件`);
 console.log(` - リプライ (kind:1): ${posts.length}件`);
 console.log(` - リポスト (kind:6): ${reposts.length}件`);
 console.log(` - 引用 (kind:16): ${quotes.length}件`);
 if (reactions.length > 0) renderReactions(reactions, customEmojiMap);
 if (posts.length > 0 || reposts.length > 0 || quotes.length > 0) {
 renderRelatedEvents(posts, reposts, quotes);
 }
 showStatus('');
 console.log('✅ すべての処理が完了しました。');
 } catch (err) {
 console.error('❌ イベントの取得中にエラーが発生しました:', err);
 showStatus('イベントの取得中にエラーが発生しました。');
 } finally {}
 }

 async function renderProfileDetail(nostrId) {
 showStatus('プロフィール情報を取得中...');
 try {
 const decoded = window.NostrTools.nip19.decode(nostrId);
 if (decoded.type !== 'npub' && decoded.type !== 'nprofile') {
 showStatus('エラー: 無効なnpubまたはnprofile形式です。');
 return;
 }
 const relays = (decoded.data.relays && decoded.data.relays.length > 0) ? decoded.data.relays : FALLBACK_RELAYS;
 const pubkey = decoded.data.id || decoded.data;
 const until = Math.floor(Date.now() / 1000);
 const profileEvent = await pool.get(relays, { kinds: [0], authors: [pubkey], until: until, limit: 1 });

 if (!profileEvent) {
 showStatus('プロフィールが見つかりませんでした。');
 return;
 }
 const profile = JSON.parse(profileEvent.content);
 const npub = window.NostrTools.nip19.npubEncode(pubkey);

 function formatAboutContent(content, tags) {
 if (!content) return '';
 let formattedContent = escapeHtml(content);
 const customEmojis = tags.filter(t => t[0] === 'emoji');
 const customEmojiMap = new Map();
 customEmojis.forEach(([_, shortcode, url]) => {
 const imageTag = `<img src="${url}" alt="${shortcode}" class="custom-emoji">`;
 customEmojiMap.set(`:${shortcode}:`, imageTag);
 }); 
 customEmojiMap.forEach((imageTag, shortcode) => {
 const regex = new RegExp(shortcode.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), 'g');
 formattedContent = formattedContent.replace(regex, imageTag);
 });
 formattedContent = formattedContent.replace(/(https?:\/\/[^\s]+)/g, (url) => {
 if (url.includes('imgur.com')) { 
 return url;
 }
 return `<a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>`;
 });
 return formattedContent.replace(/\n/g, '<br>');
 }
 const aboutHtml = formatAboutContent(profile.about, profileEvent.tags);

 const html = `
 <div class="profile-card">
 <div class="profile-header">
 <img src="${profile.picture || DEFAULT_PROFILE_IMAGE}" alt="Profile Picture" class="profile-picture">
 <div class="profile-info-container">
 <h2 class="profile-name">${escapeHtml(profile.name)}</h2>
 <div class="npub-container">
 <span id="npub-text" class="npub-text">${npub}</span>
 <svg id="copy-npub-icon" class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
 <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
 <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
 </svg>
 </div>
 <p class="nip05">${profile.nip05 ? escapeHtml(profile.nip05) : 'NIP-05未設定'}</p>
 </div>
 </div>
 <p class="about-text">${aboutHtml}</p>
 </div>
 `;

 mainEventContainer.innerHTML = html;

 const copyIcon = document.getElementById('copy-npub-icon');
 const npubText = document.getElementById('npub-text');
 copyIcon.onclick = async () => {
 try {
 await navigator.clipboard.writeText(npub);
 alert('npubがクリップボードにコピーされました！');
 } catch (err) {
 console.error('npubのコピーに失敗しました:', err);
 alert('npubのコピーに失敗しました。');
 }
 };

 showStatus('');
 } catch (err) {
 console.error('プロフィール取得中にエラー:', err);
 showStatus('プロフィールの取得中にエラーが発生しました。');
 }
}

 function renderInputForm() {
 mainEventContainer.innerHTML = `
 <div class="input-form-container">
 <p class="form-title">イベントまたはユーザーのNostr IDを入力してください</p>
 <form id="nostr-form" class="nostr-form">
 <input type="text" id="nostr-id-input" placeholder="nevent1..., npub1..." required class="form-input">
 <button type="submit" class="form-button">表示</button>
 </form>
 </div>
 `;
 const form = document.getElementById('nostr-form');
 form.addEventListener('submit', (e) => {
 e.preventDefault();
 const input = document.getElementById('nostr-id-input').value.trim();
 if (input.startsWith('note1') || input.startsWith('nevent1') || input.startsWith('naddr1')) {
 window.location.href = `?id=${input}`;
 } else if (input.startsWith('npub1') || input.startsWith('nprofile1')) {
 window.location.href = `?id=${input}`;
 } else {
 alert('有効なNostr ID (note1, nevent1, naddr1, npub1, nprofile1) を入力してください。');
 }
 });
 }

 window.onload = () => {
 const urlParams = new URLSearchParams(window.location.search);
 const id = urlParams.get('id');
 if (id) {
 if (id.startsWith('npub1') || id.startsWith('nprofile1')) {
 renderProfileDetail(id);
 } else if (id.startsWith('note1') || id.startsWith('nevent1') || id.startsWith('naddr1')) {
 renderEventDetail(id);
 } else {
 showStatus('エラー: 無効なNostr ID形式です。');
 renderInputForm();
 }
 } else {
 renderInputForm();
 }
 };
</script>
<script src="https://ompomz.github.io/header/loadHeader.js"></script>
</body>
</html>
